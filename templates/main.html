{% extends 'main_head_content.html' %}

{% block content %}

<div class="main-wrapper">
    <div class="main-card" style="max-width: 1200px;">
        <h2 class="form-title">ğŸŒ R-Trip ì—¬í–‰ ì¶”ì²œ ì…ë ¥</h2>
        <form method="POST" action="{{ url_for('main') }}">

            <div class="form-group"> 
            {% for i in range(1,11) %}            
            <div class="form-step" id="step{{ i }}">
                <input type="hidden" id="TRAVEL_STYL_{{ i }}" name="TRAVEL_STYL_{{ i }}" value="4">
                <!-- ì—¬í–‰ ìŠ¤íƒ€ì¼ ì„ íƒ -->
                <div class="form-group text-center">
                    <h4 class="mb-4 text-center">
                        ë‚˜ë§Œì˜ ì—¬í–‰ ìŠ¤íƒ€ì¼ 
                    </h4>
                    <div class="progress-step-container">
                        {% for j in range(1, 11) %}
                            <div class="progress-step" id="progress-bar-{{ i }}-{{ j }}"></div>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="slider{{ i }}" name="style_{{ i }}">
                        <div class="style-image-row">
                            <!-- ì²« ë²ˆì§¸ ì¹´ë“œ -->
                            <div class="card-wrapper" onclick="selectStyle({{ i }}, 1)">
                                <div class="card">
                                    <img src="/static/images/register/register_{{ i }}_1.jpg" alt="style {{ i }}-1" >
                                    <div class="card-body text-center">
                                    </div> 
                                </div>
                            </div>       
                            <!-- ë‘ ë²ˆì§¸ ì¹´ë“œ -->
                            <div class="card-wrapper" onclick="selectStyle({{ i }}, 2)">
                                <div class="card">
                                    <img src="/static/images/register/register_{{ i }}_2.jpg" alt="style {{ i }}-2" >
                                    <div class="card-body text-center">
                                    </div>
                                </div>
                            </div>   
                        </div>
                </div>
            </div>
            {% endfor %}
            </div>
             <!-- ì„±í–¥ë³„ ì¶”ì²œ + íšŒì›ê°€ì… -->
            <div class="form-step" id="step11">
                <div class="form-group">                    
                    <div id="style-analysis" class="text-center mt-3">
                        <div class="style-bar-progress">
                        </div>
                    </div>

                        <div id = "slider-wrapper">
                            <div id="slider-container">
                                {% for img in images %}
                                    <a>
                                    <div class="slide">
                                        <img 
                                            src="{{ img.url | safe }}"
                                            alt="image {{ loop.index }}"
                                            class="header-phone img-responsive wow fadeInRight"
                                            style="width: 100%; object-fit: cover;"
                                            draggable="false">
                                        <div class="landing-text text-center">
                                            {{ img.area }}
                                        </div>
                                        </a>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                            
                        <div class='landing-text wow fadeInRight text-center'> 
                            <p>ìœ ì‚¬ ì„±í–¥ ì‚¬ìš©ìë“¤ì´ ìì£¼ ë°©ë¬¸í•œ ì¥ì†Œì…ë‹ˆë‹¤ </p>
                        </div>
          
                        <div class="text-center">
                            <div class="btn-group">
                                <!-- ê³„ì •ì´ ìˆëŠ” ê²½ìš° -->
                                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#loginModal">
                                ë¡œê·¸ì¸
                                </button>
                                <!-- ê³„ì •ì´ ì—†ëŠ” ê²½ìš° -->
                                <a href="{{ url_for('main_register') }}" class="btn btn-primary btn-lg">
                                    íšŒì›ê°€ì…
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
    
    .form-title {
        text-align: center;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 30px;
        color: #333;
    }
    .form-group label {
        font-weight: 600;
        margin-top: 10px;
    }
    .main-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 60px 20px;
        background-color: #f0f2f5;
    }
    .main-card {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 40px;
        width: 100%;
        max-width:600px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease-in-out;
    }
    .main-card:hover {
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.15);
    }
    .form-step {
        display: none;
    }
    .form-step.active {
        display: block;
    }
    
    input[type=range].hidden-slider {
        display: none !important;
    }
    .fixed-size-img {
        width: 100%;
        height: 500px;
        object-fit: cover;
    }
    .card-wrapper {
        width: 42%;
        /* max-width: 260px; */
        margin: 10px;
    }
    .card-wrapper:hover {
        transform: translateY(-5px);
        transition: transform 0.3s ease-in-out;
    }
    .card {
        border: none;
        /* width: 100%;
        max-width: 300px; */
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    .card img {
        width: 100%;
        /* height: 50rem; */
        max-height: 300px;
        height: 300px;
        object-fit: cover; 
        border-radius: 20px;
        display: block;
    }
    .card-body {
        padding: 14px;
        background-color: #ffffff;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        font-weight: 500;
        color: #333;
    }
    @media screen and (max-width: 768px) {
        .card-wrapper {
            width: 90%;
            max-width: none;
        }
    }
    .style-image-row {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap; /* ëª¨ë°”ì¼ ëŒ€ì‘ */
    }
    @media screen and (max-width: 768px) {
        .style-image-row {
            flex-direction: column;
            align-items: center;
        }
    }

    #slider-wrapper {
        overflow: hidden;
        width: 100%;
        margin: 0 auto;
        padding: 20px 0;
    }
    #slider-container {
        display: flex;
        transition: transform 0.5s ease-in-out;
        will-change: transform;
        width: max-content;
        justify-content: center;
        gap: 16px;
        
    }
    .slide {
        flex: 0 0 18%;
        max-width: 200px;
        box-sizing: border-box;
        padding: 5px;
    }

    .slide img {
        width: 100%;
        height: 200px;      
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: block;
    }
    .form-step {
        overflow: hidden; 
    }

    @media (max-width: 768px) {
        .slide {
            flex: 0 0 40%;
            max-width: 140px;
        }

        .slide img {
            height: 100px;
        }
    }


</style>

<script>
    let currentStep = 1;

    function showStep(step) {
    document.querySelectorAll('.form-step').forEach((el) => {
        el.classList.remove('active');
    });

    const target = document.getElementById(`step${step}`);
    if (target) {
        target.classList.add('active');
        currentStep = step;

        updateProgress(step);

        if (step === 11) {
            analyzeStyles();  // step10ì—ì„œ ë¶„ì„ ì‹¤í–‰
        }
    }
}
    function updateProgress(step) {
        const total = 10;
        for (let i = 1; i <= total; i++) {
            const el = document.getElementById(`progress-bar-${step}-${i}`);
            if (el) {
                el.classList.toggle('active', i <= step);
            }
        }

        // ìˆ«ì ë ˆì´ë¸”ë„ ì—…ë°ì´íŠ¸
        const label = document.getElementById(`progress-label-${step}`);
        if (label) {
            label.innerText = step;
        }
    }
    function analyzeStyles() {
        const labels = [
            ["ìì—°í˜•", "ë„ì‹œí˜•", "ìì—° vs ë„ì‹œ", "blue"],
            ["ìˆ™ë°•ëŸ¬", "ë‹¹ì¼ëŸ¬", "ìˆ™ë°• vs ë‹¹ì¼", "orange"],
            ["ìƒˆë¡œìš´ ì§€ì—­íŒŒ", "ìµìˆ™í•œ ì§€ì—­íŒŒ", "ì§€ì—­ ì„±í–¥", "green"],
            ["ëŸ­ì…”ë¦¬íŒŒ", "ì‹¤ì†íŒŒ", "ìˆ™ì†Œ ì„±í–¥", "pink"],
            ["íœ´ì–‘ëŸ¬", "ì²´í—˜ëŸ¬", "ì—¬í–‰ ëª©ì ", "purple"],
            ["ìˆ¨ì€ ì¥ì†Œ ì„ í˜¸", "í•«í”Œ ì„ í˜¸", "ì¥ì†Œ ì·¨í–¥", "red"],
            ["ê³„íší˜•", "ì¦‰í¥í˜•", "ì—¬í–‰ ìŠ¤íƒ€ì¼", "indigo"],
            ["ì‚¬ì§„ ë¬´ê´€ì‹¬", "ì‚¬ì§„ ì¤‘ìš”", "ê¸°ì–µ ë°©ì‹", "teal"]
        ];

        let html = `<h4 class="text-center">ğŸ“Š ë‚˜ì˜ ì—¬í–‰ ì„±í–¥ ë¶„ì„</h4>`;

        for (let i = 0; i < 8; i++) {
            const score = scores[i];
            const percent = Math.round((score / 8) * 100);
            const leftPercent = 100 - percent;
            const [leftLabel, rightLabel, title, color] = labels[i];

            const isRightDominant = percent > 50;
            const isEqual = percent === 50;
            // console.log(`Style ${i + 1} / Score: ${score} / Percent: ${percent}% â†’ ${isRightDominant ? 'ì˜¤ë¥¸ìª½' : 'ì™¼ìª½'}`);

            html += `
                <div class="style-bar">
                    <div class="style-bar-title">${title}</div>
                    <div class="style-bar-labels">
                        <span>${leftLabel} (${leftPercent}%)</span>
                        <span>${rightLabel} (${percent}%)</span>
                    </div>
                    <div class="style-bar-progress">
                        ${isRightDominant ? `
                            <div class="style-bar-fill right-fill" style="width: ${percent}%;" data-color="${color}"></div>
                        ` : `
                            <div class="style-bar-fill left-fill" style="width: ${leftPercent}%;" data-color="${color}"></div>
                        `}
                    </div>
                </div>
            `;
        }

        document.getElementById("style-analysis").innerHTML = html;
    }



    function nextStep() {
        showStep(currentStep + 1);
    }

    document.addEventListener("DOMContentLoaded", () => {
        showStep(currentStep);
    });

    // ê°€ì¤‘ì¹˜ ë§¤í•‘ í…Œì´ë¸” 
    const weightMap = {
        1: {
            1: [-1, 0, -1, 1, -1, 0, 1, 1],  // í•´ë¨¹
            2: [1, 0, 1, 0, 1, 0, 0, 1]      // ë¡¯ë°ì›”ë“œ
        },
        2: {
            1: [1, 1, 0, -1, -1, 0, -1, 0],  // í˜¸í…”
            2: [-1, 1, 0, 1, 1, 0, 0, 0]     // ìº í•‘
        },
        3: {
            1: [1, 1, 1, 0, -1, 0, 1, -1],   // ë°±í™”ì 
            2: [0, -1, -1, 0, 1, 0, 0, 1]    // ì˜ë í”„ë‘ìŠ¤
        },
        4: {
            1: [-1, -1, 0, 1, 1, -1, -1, -1],// ê³„ê³¡
            2: [1, 1, 1, 0, -1, 1, 1, 1]     // ë°˜í¬ëŒ€êµ
        },
        5: {
            1: [0, 0, -1, 0, 0, 1, 0, -1],   // ë¶ˆêµ­ì‚¬
            2: [0, -1, 0, 1, -1, 0, 1, 0]    // ê²ŒìŠ¤íŠ¸í•˜ìš°ìŠ¤
        },
        6: {
            1: [-1, -1, -1, 0, 0, 1, -1, 1], // ì „ì£¼ í•œì˜¥ë§ˆì„
            2: [1, 1, 1, -1, 0, 1, 1, 1]     // ì„œìš¸ ì•¼ê²½
        },
        7: {
            1: [0, 0, -1, 0, 0, -1, 1, 1],   // ì²œì•ˆ ë¯¸ë‚˜ë¦¿ê¸¸
            2: [-1, 0, -1, 0, 0, -1, -1, 1]  // ë•ì§„ê³µì›
        },
        8: {
            1: [0, 0, 0, 1, 0, 0, 1, -1],    // ë¡œë°ì˜¤ê±°ë¦¬
            2: [1, 0, 1, -1, 0, 0, 0, -1]    // ì¸ê³„ë™
        },
        9: {
            1: [0, -1, 0, -1, -1, 1, -1, 0], // ì—¬ìˆ˜
            2: [-1, 0, 0, 0, 1, -1, 1, -1]   // ë§ˆì´ì‚°
        },
        10: {
            1: [1, 1, 0, 0, 1, -1, -1, -1],  // ì•ˆë™í•˜íšŒë§ˆì„
            2: [-1, -1, 1, -1, 0, 0, -1, -1] // ê·¸ëœë“œ ì¡°ì„  ë¶€ì‚°
        }
    };

    // ì„±í–¥ë¶„ì„ ì´ë¯¸ì§€ ê³„ì‚° 
    const scores = Array(8).fill(4);

    function selectStyle(step, choice) {
        const weight = weightMap[step][choice];
        for (let i = 0; i < 8; i++) {
            scores[i] += weight[i];
        }

        if (step === 10) {
            for (let i = 0; i < 8; i++) {
                scores[i] = Math.max(1, Math.min(7, scores[i]));
            }
        }
        
        // hidden input ë°˜ì˜
        for (let i = 0; i < 8; i++) {
            document.getElementById(`TRAVEL_STYL_${i + 1}`).value = scores[i];
        }

        // ê°œë³„ ì§ˆë¬¸ ì„ íƒê°’ ì €ì¥
        document.getElementById(`slider${step}`).value = choice;

        
        if (step === 10) {
            showStep(11);  // ë§ˆì§€ë§‰ì´ë©´ ë°”ë¡œ step11ë¡œ
        } else {
            nextStep();    // ê·¸ ì™¸ì—” í‰ì†ŒëŒ€ë¡œ
        }
    }

</script>

<style>
    .style-bar-container {
        max-width: 700px;
        margin: 0 auto;
    }

    .style-bar {
        margin-bottom: 25px;
    }

    .style-bar-labels {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        font-weight: 600;
        font-size: 14px;
    }

    .style-bar-title {
        text-align: center;
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 16px;
    }

    .style-bar-progress {
        position: relative;
        height: 24px;
        background: #e0e0e0;
        border-radius: 12px;
        overflow: hidden;
    }

    .style-bar-fill {
        position: absolute;
        top: 0;
        height: 100%;
        font-size: 12px;
        font-weight: bold;
        color: #fff;
        padding: 0 8px;
        line-height: 24px;
    }

    .left-fill {
        left: 0;
        text-align: left;
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
    }

    .right-fill {
        position: absolute;
        right: 0;
        top: 0;
        border-top-right-radius: 12px;
        border-bottom-right-radius: 12px;
    }

    .style-bar-fill[data-color="blue"]    { background-color: #3CB3FF; }
    .style-bar-fill[data-color="orange"]  { background-color: #FFB347; }
    .style-bar-fill[data-color="green"]   { background-color: #61C09B; }
    .style-bar-fill[data-color="pink"]    { background-color: #D58BD1; }
    .style-bar-fill[data-color="purple"]  { background-color: #8378D5; }
    .style-bar-fill[data-color="red"]     { background-color: #FF6F6F; }
    .style-bar-fill[data-color="indigo"]  { background-color: #7E57C2; }
    .style-bar-fill[data-color="teal"]    { background-color: #26A69A; }

</style>
<style>
    .progress-step-container {
    display: flex;
    justify-content: center;
    margin: 10px 0 20px;
    gap: 4px;
    }

    .progress-step {
    width: 20px;
    height: 12px;
    border-radius: 4px;
    background-color: #e0e0e0;
    transition: background-color 0.3s;
    }

    .progress-step.active {
    background-color: #3CB3FF;  /* íŒŒë€ìƒ‰ or ì›í•˜ëŠ” ìƒ‰ìƒ */
    }

</style>

<script>
let isDragging = false;
let startX;
let scrollLeft;

const slider = document.getElementById("slider-container");
const wrapper = document.getElementById("slider-wrapper");

// Mouse events
wrapper.addEventListener("mousedown", (e) => {
  isDragging = true;
  wrapper.classList.add("dragging");
  startX = e.pageX - wrapper.offsetLeft;
  scrollLeft = wrapper.scrollLeft;
});

wrapper.addEventListener("mouseleave", () => {
  isDragging = false;
  wrapper.classList.remove("dragging");
});

wrapper.addEventListener("mouseup", () => {
  isDragging = false;
  wrapper.classList.remove("dragging");
});

wrapper.addEventListener("mousemove", (e) => {
  if (!isDragging) return;
  e.preventDefault();
  const x = e.pageX - wrapper.offsetLeft;
  const walk = (x - startX) * 1.2; // drag ì†ë„ ì¡°ì ˆ
  wrapper.scrollLeft = scrollLeft - walk;
});

// Touch events
wrapper.addEventListener("touchstart", (e) => {
  isDragging = true;
  startX = e.touches[0].pageX - wrapper.offsetLeft;
  scrollLeft = wrapper.scrollLeft;
});

wrapper.addEventListener("touchend", () => {
  isDragging = false;
});

wrapper.addEventListener("touchmove", (e) => {
  if (!isDragging) return;
  const x = e.touches[0].pageX - wrapper.offsetLeft;
  const walk = (x - startX) * 1.2;
  wrapper.scrollLeft = scrollLeft - walk;
});
</script>

{% endblock %}