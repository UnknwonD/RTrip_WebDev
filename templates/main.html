{% extends 'main_head_content.html' %}

{% block content %}

<div class="main-wrapper">
    <div class="main-card" style="max-width: 1200px;">
        <h2 class="form-title">üåè R-Trip Ïó¨Ìñâ Ï∂îÏ≤ú ÏûÖÎ†•</h2>
        <form method="POST" action="{{ url_for('main') }}">

            <div class="form-group"> 
            {% for i in range(1,11) %}            
            <div class="form-step" id="step{{ i }}">
                <input type="hidden" id="TRAVEL_STYL_{{ i }}" name="TRAVEL_STYL_{{ i }}" value="4">
                <!-- Ïó¨Ìñâ Ïä§ÌÉÄÏùº ÏÑ†ÌÉù -->
                <div class="form-group text-center">
                    <h4 class="mb-4 text-center">
                        ÎÇòÎßåÏùò Ïó¨Ìñâ Ïä§ÌÉÄÏùº 
                    </h4>
                    <div class="progress-step-container">
                        {% for j in range(1, 11) %}
                            <div class="progress-step" id="progress-bar-{{ i }}-{{ j }}"></div>
                        {% endfor %}
                    </div>
                    <input type="hidden" id="slider{{ i }}" name="style_{{ i }}">
                        <div class="style-image-row">
                            <!-- Ï≤´ Î≤àÏß∏ Ïπ¥Îìú -->
                            <div class="card-wrapper" onclick="selectStyle({{ i }}, 1)">
                                <div class="card">
                                    <img src="/static/images/register/register_{{ i }}_1.jpg" alt="style {{ i }}-1" >
                                    <div class="card-body text-center">
                                    </div> 
                                </div>
                            </div>       
                            <!-- Îëê Î≤àÏß∏ Ïπ¥Îìú -->
                            <div class="card-wrapper" onclick="selectStyle({{ i }}, 2)">
                                <div class="card">
                                    <img src="/static/images/register/register_{{ i }}_2.jpg" alt="style {{ i }}-2" >
                                    <div class="card-body text-center">
                                    </div>
                                </div>
                            </div>   
                        </div>
                </div>
            </div>
            {% endfor %}
            </div>
             <!-- ÏÑ±Ìñ•Î≥Ñ Ï∂îÏ≤ú + ÌöåÏõêÍ∞ÄÏûÖ -->
            <div class="form-step" id="step11">
                <div class="form-group">                    
                    <div id="style-analysis" class="text-center mt-3">
                        <div class="style-bar-progress">
                        </div>
                    </div>

                        <div id = "slider-wrapper">
                            <div id="slider-container">
                                {% for img in images %}
                                    <a>
                                    <div class="slide">
                                        <img 
                                            src="{{ img.url | safe }}"
                                            alt="image {{ loop.index }}"
                                            class="header-phone img-responsive wow fadeInRight"
                                            style="width: 100%; object-fit: cover;"
                                            draggable="false">
                                        <div class="landing-text text-center">
                                            {{ img.area }}
                                        </div>
                                        </a>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                            
                        <div class='landing-text wow fadeInRight text-center'> 
                            <p>Ïú†ÏÇ¨ ÏÑ±Ìñ• ÏÇ¨Ïö©ÏûêÎì§Ïù¥ ÏûêÏ£º Î∞©Î¨∏Ìïú Ïû•ÏÜåÏûÖÎãàÎã§ </p>
                        </div>
          
                        <div class="text-center">
                            <div class="btn-group">
                                <!-- Í≥ÑÏ†ïÏù¥ ÏûàÎäî Í≤ΩÏö∞ -->
                                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#loginModal">
                                Î°úÍ∑∏Ïù∏
                                </button>
                                <!-- Í≥ÑÏ†ïÏù¥ ÏóÜÎäî Í≤ΩÏö∞ -->
                                <a href="{{ url_for('main_register') }}" class="btn btn-primary btn-lg">
                                    ÌöåÏõêÍ∞ÄÏûÖ
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
    
    .form-title {
        text-align: center;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 30px;
        color: #333;
    }
    .form-group label {
        font-weight: 600;
        margin-top: 10px;
    }
    .main-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 60px 20px;
        background-color: #f0f2f5;
    }
    .main-card {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 40px;
        width: 100%;
        max-width:600px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease-in-out;
    }
    .main-card:hover {
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.15);
    }
    .form-step {
        display: none;
    }
    .form-step.active {
        display: block;
    }
    
    input[type=range].hidden-slider {
        display: none !important;
    }
    .fixed-size-img {
        width: 100%;
        height: 500px;
        object-fit: cover;
    }
    .card-wrapper {
        width: 42%;
        /* max-width: 260px; */
        margin: 10px;
    }
    .card-wrapper:hover {
        transform: translateY(-5px);
        transition: transform 0.3s ease-in-out;
    }
    .card {
        border: none;
        /* width: 100%;
        max-width: 300px; */
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    .card img {
        width: 100%;
        /* height: 50rem; */
        max-height: 300px;
        height: 300px;
        object-fit: cover; 
        border-radius: 20px;
        display: block;
    }
    .card-body {
        padding: 14px;
        background-color: #ffffff;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        font-weight: 500;
        color: #333;
    }
    @media screen and (max-width: 768px) {
        .card-wrapper {
            width: 90%;
            max-width: none;
        }
    }
    .style-image-row {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap; /* Î™®Î∞îÏùº ÎåÄÏùë */
    }
    @media screen and (max-width: 768px) {
        .style-image-row {
            flex-direction: column;
            align-items: center;
        }
    }

    #slider-wrapper {
        overflow: hidden;
        width: 100%;
        margin: 0 auto;
        padding: 20px 0;
    }
    #slider-container {
        display: flex;
        transition: transform 0.5s ease-in-out;
        will-change: transform;
        width: max-content;
        justify-content: center;
        gap: 16px;
        
    }
    .slide {
        flex: 0 0 18%;
        max-width: 200px;
        box-sizing: border-box;
        padding: 5px;
    }

    .slide img {
        width: 100%;
        height: 200px;      
        object-fit: cover;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: block;
    }
    .form-step {
        overflow: hidden; 
    }

    @media (max-width: 768px) {
        .slide {
            flex: 0 0 40%;
            max-width: 140px;
        }

        .slide img {
            height: 100px;
        }
    }


</style>

<script>
    let currentStep = 1;

    function showStep(step) {
    document.querySelectorAll('.form-step').forEach((el) => {
        el.classList.remove('active');
    });

    const target = document.getElementById(`step${step}`);
    if (target) {
        target.classList.add('active');
        currentStep = step;

        updateProgress(step);

        if (step === 11) {
            analyzeStyles();  // step10ÏóêÏÑú Î∂ÑÏÑù Ïã§Ìñâ
        }
    }
}
    function updateProgress(step) {
        const total = 10;
        for (let i = 1; i <= total; i++) {
            const el = document.getElementById(`progress-bar-${step}-${i}`);
            if (el) {
                el.classList.toggle('active', i <= step);
            }
        }

        // Ïà´Ïûê Î†àÏù¥Î∏îÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
        const label = document.getElementById(`progress-label-${step}`);
        if (label) {
            label.innerText = step;
        }
    }
    function analyzeStyles() {
        const labels = [
            ["ÏûêÏó∞Ìòï", "ÎèÑÏãúÌòï", "ÏûêÏó∞ vs ÎèÑÏãú", "blue"],
            ["ÏàôÎ∞ïÎü¨", "ÎãπÏùºÎü¨", "ÏàôÎ∞ï vs ÎãπÏùº", "orange"],
            ["ÏÉàÎ°úÏö¥ ÏßÄÏó≠Ìåå", "ÏùµÏàôÌïú ÏßÄÏó≠Ìåå", "ÏßÄÏó≠ ÏÑ±Ìñ•", "green"],
            ["Îü≠ÏÖîÎ¶¨Ìåå", "Ïã§ÏÜçÌåå", "ÏàôÏÜå ÏÑ±Ìñ•", "pink"],
            ["Ìú¥ÏñëÎü¨", "Ï≤¥ÌóòÎü¨", "Ïó¨Ìñâ Î™©Ï†Å", "purple"],
            ["Ïà®ÏùÄ Ïû•ÏÜå ÏÑ†Ìò∏", "Ìï´Ìîå ÏÑ†Ìò∏", "Ïû•ÏÜå Ï∑®Ìñ•", "red"],
            ["Í≥ÑÌöçÌòï", "Ï¶âÌù•Ìòï", "Ïó¨Ìñâ Ïä§ÌÉÄÏùº", "indigo"],
            ["ÏÇ¨ÏßÑ Î¨¥Í¥ÄÏã¨", "ÏÇ¨ÏßÑ Ï§ëÏöî", "Í∏∞Ïñµ Î∞©Ïãù", "teal"]
        ];

        let html = `<h4 class="text-center">üìä ÎÇòÏùò Ïó¨Ìñâ ÏÑ±Ìñ• Î∂ÑÏÑù</h4>`;

        for (let i = 0; i < 8; i++) {
            const score = scores[i];
            const percent = Math.round((score / 8) * 100);
            const leftPercent = 100 - percent;
            const [leftLabel, rightLabel, title, color] = labels[i];

            const isRightDominant = percent > 50;
            const isEqual = percent === 50;
            // console.log(`Style ${i + 1} / Score: ${score} / Percent: ${percent}% ‚Üí ${isRightDominant ? 'Ïò§Î•∏Ï™Ω' : 'ÏôºÏ™Ω'}`);

            html += `
                <div class="style-bar">
                    <div class="style-bar-title">${title}</div>
                    <div class="style-bar-labels">
                        <span>${leftLabel} (${leftPercent}%)</span>
                        <span>${rightLabel} (${percent}%)</span>
                    </div>
                    <div class="style-bar-progress">
                        ${isRightDominant ? `
                            <div class="style-bar-fill right-fill" style="width: ${percent}%;" data-color="${color}"></div>
                        ` : `
                            <div class="style-bar-fill left-fill" style="width: ${leftPercent}%;" data-color="${color}"></div>
                        `}
                    </div>
                </div>
            `;
        }

        document.getElementById("style-analysis").innerHTML = html;
    }



    function nextStep() {
        showStep(currentStep + 1);
    }

    document.addEventListener("DOMContentLoaded", () => {
        showStep(currentStep);
    });

    // Í∞ÄÏ§ëÏπò Îß§Ìïë ÌÖåÏù¥Î∏î 
    const weightMap = {
        1: {
            1: [-1, 0, -1, 1, -1, 0, 1, 1],  // Ìï¥Î®π
            2: [1, 0, 1, 0, 1, 0, 0, 1]      // Î°ØÎç∞ÏõîÎìú
        },
        2: {
            1: [1, 1, 0, -1, -1, 0, -1, 0],  // Ìò∏ÌÖî
            2: [-1, 1, 0, 1, 1, 0, 0, 0]     // Ï∫†Ìïë
        },
        3: {
            1: [1, 1, 1, 0, -1, 0, 1, -1],   // Î∞±ÌôîÏ†ê
            2: [0, -1, -1, 0, 1, 0, 0, 1]    // ÏÅòÎù†ÌîÑÎûëÏä§
        },
        4: {
            1: [-1, -1, 0, 1, 1, -1, -1, -1],// Í≥ÑÍ≥°
            2: [1, 1, 1, 0, -1, 1, 1, 1]     // Î∞òÌè¨ÎåÄÍµê
        },
        5: {
            1: [0, 0, -1, 0, 0, 1, 0, -1],   // Î∂àÍµ≠ÏÇ¨
            2: [0, -1, 0, 1, -1, 0, 1, 0]    // Í≤åÏä§Ìä∏ÌïòÏö∞Ïä§
        },
        6: {
            1: [-1, -1, -1, 0, 0, 1, -1, 1], // Ï†ÑÏ£º ÌïúÏò•ÎßàÏùÑ
            2: [1, 1, 1, -1, 0, 1, 1, 1]     // ÏÑúÏö∏ ÏïºÍ≤Ω
        },
        7: {
            1: [0, 0, -1, 0, 0, -1, 1, 1],   // Ï≤úÏïà ÎØ∏ÎÇòÎ¶øÍ∏∏
            2: [-1, 0, -1, 0, 0, -1, -1, 1]  // ÎçïÏßÑÍ≥µÏõê
        },
        8: {
            1: [0, 0, 0, 1, 0, 0, 1, -1],    // Î°úÎç∞Ïò§Í±∞Î¶¨
            2: [1, 0, 1, -1, 0, 0, 0, -1]    // Ïù∏Í≥ÑÎèô
        },
        9: {
            1: [0, -1, 0, -1, -1, 1, -1, 0], // Ïó¨Ïàò
            2: [-1, 0, 0, 0, 1, -1, 1, -1]   // ÎßàÏù¥ÏÇ∞
        },
        10: {
            1: [1, 1, 0, 0, 1, -1, -1, -1],  // ÏïàÎèôÌïòÌöåÎßàÏùÑ
            2: [-1, -1, 1, -1, 0, 0, -1, -1] // Í∑∏ÎûúÎìú Ï°∞ÏÑ† Î∂ÄÏÇ∞
        }
    };

    // ÏÑ±Ìñ•Î∂ÑÏÑù Ïù¥ÎØ∏ÏßÄ Í≥ÑÏÇ∞ 
    const scores = Array(8).fill(4);

    function selectStyle(step, choice) {
        const weight = weightMap[step][choice];
        for (let i = 0; i < 8; i++) {
            scores[i] += weight[i];
        }

        if (step === 10) {
            for (let i = 0; i < 8; i++) {
                scores[i] = Math.max(1, Math.min(7, scores[i]));
            }
        }
        
        // hidden input Î∞òÏòÅ
        for (let i = 0; i < 8; i++) {
            document.getElementById(`TRAVEL_STYL_${i + 1}`).value = scores[i];
        }

        // Í∞úÎ≥Ñ ÏßàÎ¨∏ ÏÑ†ÌÉùÍ∞í Ï†ÄÏû•
        document.getElementById(`slider${step}`).value = choice;

        
        if (step === 10) {
            showStep(11);  // ÎßàÏßÄÎßâÏù¥Î©¥ Î∞îÎ°ú step11Î°ú
        } else {
            nextStep();    // Í∑∏ Ïô∏Ïóî ÌèâÏÜåÎåÄÎ°ú
        }
    }

</script>

<style>
    .style-bar-container {
        max-width: 700px;
        margin: 0 auto;
    }

    .style-bar {
        margin-bottom: 25px;
    }

    .style-bar-labels {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px;
        font-weight: 600;
        font-size: 14px;
    }

    .style-bar-title {
        text-align: center;
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 16px;
    }

    .style-bar-progress {
        position: relative;
        height: 24px;
        background: #e0e0e0;
        border-radius: 12px;
        overflow: hidden;
    }

    .style-bar-fill {
        position: absolute;
        top: 0;
        height: 100%;
        font-size: 12px;
        font-weight: bold;
        color: #fff;
        padding: 0 8px;
        line-height: 24px;
    }

    .left-fill {
        left: 0;
        text-align: left;
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
    }

    .right-fill {
        position: absolute;
        right: 0;
        top: 0;
        border-top-right-radius: 12px;
        border-bottom-right-radius: 12px;
    }

    .style-bar-fill[data-color="blue"]    { background-color: #3CB3FF; }
    .style-bar-fill[data-color="orange"]  { background-color: #FFB347; }
    .style-bar-fill[data-color="green"]   { background-color: #61C09B; }
    .style-bar-fill[data-color="pink"]    { background-color: #D58BD1; }
    .style-bar-fill[data-color="purple"]  { background-color: #8378D5; }
    .style-bar-fill[data-color="red"]     { background-color: #FF6F6F; }
    .style-bar-fill[data-color="indigo"]  { background-color: #7E57C2; }
    .style-bar-fill[data-color="teal"]    { background-color: #26A69A; }

</style>
<style>
    .progress-step-container {
    display: flex;
    justify-content: center;
    margin: 10px 0 20px;
    gap: 4px;
    }

    .progress-step {
    width: 20px;
    height: 12px;
    border-radius: 4px;
    background-color: #e0e0e0;
    transition: background-color 0.3s;
    }

    .progress-step.active {
    background-color: #3CB3FF;  /* ÌååÎûÄÏÉâ or ÏõêÌïòÎäî ÏÉâÏÉÅ */
    }

</style>

<script>
let isDragging = false;
let startX;
let scrollLeft;

const slider = document.getElementById("slider-container");
const wrapper = document.getElementById("slider-wrapper");

// Mouse events
wrapper.addEventListener("mousedown", (e) => {
  isDragging = true;
  wrapper.classList.add("dragging");
  startX = e.pageX - wrapper.offsetLeft;
  scrollLeft = wrapper.scrollLeft;
});

wrapper.addEventListener("mouseleave", () => {
  isDragging = false;
  wrapper.classList.remove("dragging");
});

wrapper.addEventListener("mouseup", () => {
  isDragging = false;
  wrapper.classList.remove("dragging");
});

wrapper.addEventListener("mousemove", (e) => {
  if (!isDragging) return;
  e.preventDefault();
  const x = e.pageX - wrapper.offsetLeft;
  const walk = (x - startX) * 1.2; // drag ÏÜçÎèÑ Ï°∞Ï†à
  wrapper.scrollLeft = scrollLeft - walk;
});

// Touch events
wrapper.addEventListener("touchstart", (e) => {
  isDragging = true;
  startX = e.touches[0].pageX - wrapper.offsetLeft;
  scrollLeft = wrapper.scrollLeft;
});

wrapper.addEventListener("touchend", () => {
  isDragging = false;
});

wrapper.addEventListener("touchmove", (e) => {
  if (!isDragging) return;
  const x = e.touches[0].pageX - wrapper.offsetLeft;
  const walk = (x - startX) * 1.2;
  wrapper.scrollLeft = scrollLeft - walk;
});
</script>

{% endblock %}