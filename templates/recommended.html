{% extends 'head_content.html' %}

{% block content %}

<style>
    .recommend-wrapper {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 60px 20px;
        background-color: #f0f2f5;
    }

    .recommend-card {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 40px;
        width: 100%;
        max-width: 600px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease-in-out;
    }

    .recommend-card:hover {
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.15);
    }

    .form-title {
        text-align: center;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 30px;
        color: #333;
    }

    .form-group label {
        font-weight: 600;
        margin-top: 10px;
    }

    .form-control {
        border-radius: 6px;
        padding: 10px;
        font-size: 14px;
        margin-top: 5px;
    }

    .btn-submit {
        width: 100%;
        background-color: #655cff;
        color: white;
        font-weight: bold;
        padding: 12px;
        border-radius: 6px;
        border: none;
        margin-top: 20px;
        font-size: 16px;
    }

    .btn-submit:hover {
        background-color: #534cf3;
    }
    label {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
    }
    [type="checkbox"] {
        appearance: none;
    }
    [type="checkbox"] {
        appearance: none;
        position: relative;
        border: max(2px, 0.1em) solid gray;
        border-radius: 1.25em;
        width: 2.25em;
        height: 1.25em;
    }
    [type="checkbox"]::before {
        content: "";
        position: absolute;
        left: 0;
        width: 1em;
        height: 1em;
        border-radius: 50%;
        transform: scale(0.8);
        background-color: gray;
        transition: left 250ms linear;
    }
    [type="checkbox"]:checked::before {
        background-color: white;
        left: 1em;
    }

    [type="checkbox"]:checked {
        background-color: rgb(101, 74, 255);
        border-color: #4787ff;
    }
    [type="checkbox"]:disabled {
        border-color: lightgray;
        opacity: 0.7;
        cursor: not-allowed;
    }

    [type="checkbox"]:disabled:before {
        background-color: lightgray;
    }

    [type="checkbox"]:disabled + span {
        opacity: 0.7;
        cursor: not-allowed;
    }
    [type="checkbox"]:focus-visible {
        outline-offset: max(2px, 0.1em);
        outline: max(2px, 0.1em) solid rgb(99, 71, 255);
    }
    [type="checkbox"]:enabled:hover {
        box-shadow: 0 0 0 max(4px, 0.2em) lightgray;
    }
    [type="checkbox"]::before {
        content: "";
        position: absolute;
        left: 0;
        width: 1em;
        height: 1em;
        border-radius: 50%;
        transform: scale(0.8);
        background-color: gray;
        transition: left 250ms linear;
    }
    select.form-control {
    padding: 10px 12px;
    line-height: 1.4;
    height: auto;
    font-size: 14px;
    } 
    .cost-input {
  padding-right: 40px; /* ì—¬ìœ  ê³µê°„ í™•ë³´ */
}

.unit-label {
  position: absolute;
  top: 50%;       
  transform: translateY(35%); 
  right: 10px;
  font-size: 13px;
  color: #555;
  pointer-events: none;
}
</style>

<div class="recommend-wrapper">
    <div class="recommend-card">
        <h2 class="form-title">ğŸŒ R-Trip ì—¬í–‰ ì¶”ì²œ ì…ë ¥</h2>

        <form method="POST" action="{{ url_for('recommended') }}">
            <!-- ì—¬í–‰ ìœ í˜• -->
            <div class="form-group" style="display: flex; align-items: flex-end; gap: 20px;">
                <div style="flex: 1;">
                    <label>ğŸ¯ ì—¬í–‰ ìœ í˜•</label><br>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <input role="switch" type="checkbox" id="missionToggle" />
                        <span id='missionToggleLabel'>ì¼ë°˜ ì—¬í–‰</span>
                    </label>
                </div>

                <div class="form-group" id="normal_mission_fields" style="padding-top:1rem; flex: 1; display: block;">
                    <label>ğŸš© ì—¬í–‰ ëª©ì  </label><br>
                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#missionModal">
                        ë¯¸ì…˜ ì„ íƒí•˜ê¸°
                    </button>
                    <input type="hidden" id="mission_ENC_hidden" name="mission_ENC">

                </div>
            </div>
            <p id="selected_missions_text" class="text-muted" style="margin-top: 10px;"></p>

            <!-- ì—¬í–‰ ê¸°ê°„ -->
            <div class="form-group">
                <label for="date_range">ğŸ“… ì—¬í–‰ ê¸°ê°„ (ì¶œë°œì¼ ~ ë„ì°©ì¼)</label>
                <input type="text" id="date_range" name="date_range" class="form-control" required>
                <input type="hidden" id="start_date" name="start_date">
                <input type="hidden" id="end_date" name="end_date">
            </div>

            <!-- ì˜ˆì‚° -->
            <div class="form-group">
                <label>ğŸ’¸ ì—¬í–‰ ì˜ˆì‚°</label>
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; position: relative;">
                        <label for="LODGOUT_COST" style="font-weight: 500;">ğŸ¨ ìˆ™ì†Œ</label>
                        <input type="number" name="LODGOUT_COST" class="form-control cost-input" placeholder="ì˜ˆ: 50" required>
                        <span class="unit-label">ë§Œì›</span>
                    </div>
                    <div style="flex: 1; position: relative;">
                        <label for="ACTIVITY_COST" style="font-weight: 500;">ğŸ« í™œë™</label>
                        <input type="number" name="ACTIVITY_COST" class="form-control cost-input" placeholder="ì˜ˆ: 30" required>
                        <span class="unit-label">ë§Œì›</span>
                    </div>
                    <div style="flex: 1; position: relative;">
                        <label for="TOTAL_COST" style="font-weight: 500;">ğŸ’° ì´í•©</label>
                        <input type="number" name="TOTAL_COST" class="form-control cost-input" placeholder="ì˜ˆ: 100" required>
                        <span class="unit-label">ë§Œì›</span>
                    </div>
                </div>
            </div>
            <!-- ì´ë™ìˆ˜ë‹¨, ë‚˜ì´ëŒ€, ë™ë°˜ì -->
            <div class="form-group">
                <label for="MVMN_NM_ENC">ğŸš— ì´ë™ìˆ˜ë‹¨</label>
                <select name="MVMN_NM_ENC" class="form-control" required>
                    {% for code, label in movement_options %}
                        <option value="{{ code }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="age_ENC">ğŸ‘¤ ë‚˜ì´ëŒ€</label>
                <input type="number" name="age_ENC" class="form-control" required>
            </div>

            <div class="form-group">
                <label for="whowith_ENC">ğŸ¤ ë™ë°˜ì</label>
                <select name="whowith_ENC" class="form-control" required>
                    {% for label, value in whowith_options %}
                        <option value="{{ loop.index }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <input type="hidden" id="mission_type_hidden" name="mission_type" value="normal">
            <button type="submit" class="btn-submit">âœ¨ ì¶”ì²œë°›ê¸°</button>
        </form>

        <div class="modal fade" id="missionModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">

      <div class="modal-header">
        <h4 class="modal-title">ğŸ¯ ì—¬í–‰ ë¯¸ì…˜ ì„ íƒ</h4>
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
      </div>

      <div class="modal-body">
        {% for code, label in purpose_options %}
          <div class="checkbox">
            <label>
              <input type="checkbox" class="mission-checkbox" value="{{ code }}"> {{ label }}
            </label>
          </div>
        {% endfor %}
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="confirmMission">í™•ì¸</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>
      </div>

    </div>
  </div>
</div>

    </div>
</div>
<script>
    document.getElementById('confirmMission').addEventListener('click', function () {
    const checkboxes = document.querySelectorAll('.mission-checkbox:checked');
    const values = Array.from(checkboxes).map(cb => cb.value);
    const labels = Array.from(checkboxes).map(cb => cb.parentNode.textContent.trim());

    // ê°’ ì €ì¥
    document.getElementById('mission_ENC_hidden').value = values.join(',');

    // UIì— ë¯¸ë¦¬ë³´ê¸°
    document.getElementById('selected_missions_text').innerText =
        labels.length > 0 ? `ì„ íƒëœ ì—¬í–‰ ëª©ì : ${labels.join(', ')}` : 'ì„ íƒëœ ëª©ì  ì—†ìŒ';

    // ëª¨ë‹¬ ë‹«ê¸°
    $('#missionModal').modal('hide');
    });
</script>
<script>
    const picker = new Litepicker({
        element: document.getElementById('date_range'),
        singleMode: false,
        format: 'YYYY-MM-DD',
        onSelect: (start, end) => {
            document.getElementById('start_date').value = start.format('YYYY-MM-DD');
            document.getElementById('end_date').value = end.format('YYYY-MM-DD');
        }
    });

    document.getElementById('missionToggle').addEventListener('change', function () {
        const isChecked = this.checked;
        const missionLabel = document.getElementById('missionToggleLabel');
        const missionFields = document.getElementById('normal_mission_fields');
        const missionTypeHidden = document.getElementById('mission_type_hidden');

        if (isChecked) {
            missionLabel.textContent = 'íŠ¹ë³„ ë¯¸ì…˜';
            missionFields.style.display = 'none';
            missionTypeHidden.value = 'special';
        } else {
            missionLabel.textContent = 'ì¼ë°˜ ì—¬í–‰';
            missionFields.style.display = 'block';
            missionTypeHidden.value = 'normal';
        }
    });

    // ì´ˆê¸°í™” ì‹œ ë¯¸ì…˜ í•„ë“œ ë³´ì´ë„ë¡
    document.getElementById('normal_mission_fields').style.display = 'block';
</script>

{% endblock %}