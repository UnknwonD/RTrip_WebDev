{% extends 'main_head_content.html' %}

{% block content %}

<style>

    /* Step ë§ˆë‹¤ í˜ì´ì§€ ìˆ¨ê¸°ê¸° */
    .form-step {
       
    }
    .form-step.d-none {
        display: none;
    }
    /* Slider ìˆ¨ê¸°ê¸° */
    input[type=range].hidden-slider {
        display: none !important;
    }
    /* ì´ë¯¸ì§€ ê³ ì • */
    .fixed-size-img {
        width: 100%;
        height: 500px;
        object-fit: cover;
    }
    .card-wrapper {
        width: 45%;
        max-width: 350px;
        margin: 10px;
        display: inline-block;
        border-radius: 20px;
        overflow: hidden;
        transition: transform 0.3s ease;
    }

    .card-wrapper:hover {
        transform: translateY(-5px);
    }

    .card {
        border: none;
        border-radius: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }

    .card img {
        width: 100%;
        aspect-ratio: 1 / 1;
        object-fit: cover;
        border-top-left-radius: 20px;
        border-top-right-radius: 20px;
    }

    .card-body {
        padding: 15px;
        background-color: #ffffff;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        font-weight: 500;
        color: #333;
    }

    @media screen and (max-width: 768px) {
        .card-wrapper {
            width: 90%;
        }
    }

    .recommend-wrapper {
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 60px 20px;
        background-color: #f0f2f5;
    }

    .recommend-card {
        background-color: #ffffff;
        border-radius: 12px;
        padding: 40px;
        width: 100%;
        max-width:600px;
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease-in-out;
    }

    .recommend-card:hover {
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.15);
    }

    .form-title {
        text-align: center;
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 30px;
        color: #333;
    }

    .form-group label {
        font-weight: 600;
        margin-top: 10px;
    }

    .form-control {
        border-radius: 6px;
        padding: 10px;
        font-size: 14px;
        margin-top: 5px;
    }

    .btn-submit {
        width: 100%;
        background-color: #655cff;
        color: white;
        font-weight: bold;
        padding: 12px;
        border-radius: 6px;
        border: none;
        margin-top: 20px;
        font-size: 16px;
    }

    .btn-submit:hover {
        background-color: rgb(150, 150, 150);
    }
    label {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
    }
    [type="checkbox"] {
        appearance: none;
    }
    [type="checkbox"] {
        appearance: none;
        position: relative;
        border: max(2px, 0.1em) solid gray;
        border-radius: 1.25em;
        width: 2.25em;
        height: 1.25em;
    }
    [type="checkbox"]::before {
        content: "";
        position: absolute;
        left: 0;
        width: 1em;
        height: 1em;
        border-radius: 50%;
        transform: scale(0.8);
        background-color: gray;
        transition: left 250ms linear;
    }
    [type="checkbox"]:checked::before {
        background-color: white;
        left: 1em;
    }

    [type="checkbox"]:checked {
        background-color: #4787ff;
        border-color: #4787ff;
    }
    [type="checkbox"]:disabled {
        border-color: lightgray;
        opacity: 0.7;
        cursor: not-allowed;
    }

    [type="checkbox"]:disabled:before {
        background-color: lightgray;
    }

    [type="checkbox"]:disabled + span {
        opacity: 0.7;
        cursor: not-allowed;
    }
    [type="checkbox"]:focus-visible {
        outline-offset: max(2px, 0.1em);
        outline: max(2px, 0.1em) solid lightgray;
    }
    [type="checkbox"]:enabled:hover {
        box-shadow: 0 0 0 max(4px, 0.2em) lightgray;
    }
    [type="checkbox"]::before {
        content: "";
        position: absolute;
        left: 0;
        width: 1em;
        height: 1em;
        border-radius: 50%;
        transform: scale(0.8);
        background-color: gray;
        transition: left 250ms linear;
    }
    select.form-control {
    padding: 10px 12px;
    line-height: 1.4;
    height: auto;
    font-size: 14px;
    } 
    .cost-input {
  padding-right: 40px; /* ì—¬ìœ  ê³µê°„ í™•ë³´ */
}

.unit-label {
  position: absolute;
  top: 50%;       
  transform: translateY(35%); 
  right: 10px;
  font-size: 13px;
  color: #555;
  pointer-events: none;
}
</style>

<div class="recommend-wrapper">
    <div class="recommend-card" style="max-width: 1200px;">
        <h2 class="form-title">ğŸŒ R-Trip ì—¬í–‰ ì¶”ì²œ ì…ë ¥</h2>
        <form method="POST" action="{{ url_for('recommended') }}">

            <div class="form-group">
            {% set labels = [
                'ìì—° vs ë„ì‹œ',
                'ìˆ™ë°• vs ë‹¹ì¼',
                'ìƒˆë¡œìš´ ì§€ì—­ vs ìµìˆ™í•œ ì§€ì—­',
                'í¸í•˜ì§€ë§Œ ë¹„ì‹¼ ìˆ™ì†Œ vs ë¶ˆí¸í•˜ì§€ë§Œ ì €ë ´í•œ ìˆ™ì†Œ',
                'íœ´ì–‘/íœ´ì‹ vs ì²´í—˜í™œë™',
                'ì˜ ì•Œë ¤ì§€ì§€ ì•Šì€ ë°©ë¬¸ì§€ vs ìœ ëª…í•œ ë°©ë¬¸ì§€',
                'ê³„íšì— ë”°ë¥¸ ì—¬í–‰ vs ì¦‰í¥ì  ì—¬í–‰',
                'ì‚¬ì§„ì´¬ì˜ ì¤‘ìš”í•˜ì§€ ì•ŠìŒ vs ì‚¬ì§„ì´¬ì˜ ì¤‘ìš”'
            ] %}

            {% for i in range(1, 9) %}
            <div class="form-step d-none" id="step-{{ i }}">
                <div class="form-group text-center">
                <h4 class="mb-4">ì—¬í–‰ ìŠ¤íƒ€ì¼ {{ i }} / 8</h4>
            <p><strong>{{ labels[i-1] }}</strong></p>

            <div class="d-flex justify-content-center flex-wrap gap-4">
                <div class="card-wrapper" onclick="selectStyle({{ i }}, 1)">
                    <div class="card">
                        <img src="/static/images/register_{{ i }}.jpg" alt="style {{ i }}-1">
                        <div class="card-body text-center">
                            <p>{{ labels[i-1].split(' vs ')[0] }}</p>
                        </div>
                    </div>
                </div>

                <div class="card-wrapper" onclick="selectStyle({{ i }}, 7)">
                    <div class="card">
                        <img src="/static/images/register_{{ i + 1 }}.jpg" alt="style {{ i }}-2">
                        <div class="card-body text-center">
                    <p>{{ labels[i-1].split(' vs ')[1] }}</p>
                    </div>
                    </div>
                </div>
            </div>


                <!-- ìˆ¨ê²¨ì§„ ìŠ¬ë¼ì´ë” ì…ë ¥ (Form ì œì¶œìš©) -->
                <input type="range" class="hidden-slider" name="TRAVEL_STYL_{{ i }}" id="slider{{ i }}" min="1" max="7" step="1" value="4">
                </div>
            </div>
            {% endfor %}
            </div>


            <!-- ì—¬í–‰ ìœ í˜• -->
            <div class="form-step d-none" id="step-9">
            <div class="form-group" style="display: flex; align-items: flex-end; gap: 20px;">
                <div style="flex: 1;">
                    <label>ğŸ¯ ì—¬í–‰ ìœ í˜•</label><br>
                        <input role="switch" type="checkbox" id="missionToggle" />
                        <span id='missionToggleLabel'>ì¼ë°˜ ì—¬í–‰</span>
                </div>


                <div id="normal_mission_fields" style="padding-top:1rem; flex: 1; display: block;">
                    <label>ğŸš© ì—¬í–‰ ëª©ì  </label><br>
                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#missionModal">
                        ë¯¸ì…˜ ì„ íƒí•˜ê¸°
                    </button>
                    <input type="hidden" id="mission_ENC_hidden" name="mission_ENC">
                </div>
            </div>
            <p id="selected_missions_text" class="text-muted" style="margin-top: 10px;"></p>

            <div class="form-group">
                <label for="date_range">ğŸ“… ì—¬í–‰ ê¸°ê°„ (ì¶œë°œì¼ ~ ë„ì°©ì¼)</label>
                <input type="text" id="date_range" name="date_range" class="form-control" required>
                <input type="hidden" id="start_date" name="start_date">
                <input type="hidden" id="end_date" name="end_date">
            </div>

            <div class="form-group">
                <label>ğŸ’¸ ì—¬í–‰ ì˜ˆì‚°</label>
                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1; position: relative;">
                        <label for="LODGOUT_COST" style="font-weight: 500;">ğŸ¨ ìˆ™ì†Œ</label>
                        <input type="number" name="LODGOUT_COST" class="form-control cost-input" placeholder="ì˜ˆ: 50" required>
                        <span class="unit-label">ë§Œì›</span>
                    </div>
                    <div style="flex: 1; position: relative;">
                        <label for="ACTIVITY_COST" style="font-weight: 500;">ğŸ« í™œë™</label>
                        <input type="number" name="ACTIVITY_COST" class="form-control cost-input" placeholder="ì˜ˆ: 30" required>
                        <span class="unit-label">ë§Œì›</span>
                    </div>
                    <div style="flex: 1; position: relative;">
                        <label for="TOTAL_COST" style="font-weight: 500;">ğŸ’° ì´í•©</label>
                        <input type="number" name="TOTAL_COST" class="form-control cost-input" placeholder="ì˜ˆ: 100" required>
                        <span class="unit-label">ë§Œì›</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="MVMN_NM_ENC">ğŸš— ì´ë™ìˆ˜ë‹¨</label>
                <select name="MVMN_NM_ENC" class="form-control" required>
                    {% for code, label in movement_options %}
                        <option value="{{ code }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label for="whowith_ENC">ğŸ¤ ë™ë°˜ì</label>
                <select name="whowith_ENC" class="form-control" required>
                    {% for label, value in whowith_options %}
                        <option value="{{ loop.index }}">{{ label }}</option>
                    {% endfor %}
                </select>
            </div>

            <input type="hidden" id="mission_type_hidden" name="mission_type" value="normal">
            <button type="submit" class="btn-submit">âœ¨ ì¶”ì²œë°›ê¸°</button>
            </div>
        </form>

        <!-- ë¯¸ì…˜ ëª¨ë‹¬ -->
        <!-- ë¯¸ì…˜ ì„ íƒ ëª¨ë‹¬ -->
<div class="modal fade" id="missionModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
  
        <div class="modal-header">
          <h4 class="modal-title">ğŸ¯ ì—¬í–‰ ë¯¸ì…˜ ì„ íƒ</h4>
          <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        </div>
  
        <div class="modal-body">
            <div class="mission-grid">
              {% for code, label in purpose_options %}
                <div class="mission-button" data-code="{{ code }}">{{ label }}</div>
              {% endfor %}
            </div>
          </div>
          
          
  
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="confirmMission">í™•ì¸</button>
          <button type="button" class="btn btn-default" data-dismiss="modal">ë‹«ê¸°</button>
        </div>
  
      </div>
    </div>
  </div>
  
        <!-- ë¯¸ì…˜ ëª¨ë¸ ë -->


    </div>
</div>

<style>
.mission-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
}

.mission-button {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 14px;
  font-size: 15px;
  font-weight: 500;
  text-align: center;
  border: 2px solid #ccc;
  border-radius: 10px;
  background-color: #f9f9f9;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  min-height: 60px;
  word-break: keep-all;
  user-select: none;
}

.mission-button:hover {
  background-color: #ededf9;
}

.mission-button.selected {
  background-color: #655cff;
  color: white;
  border-color: #655cff;
  font-weight: bold;
  box-shadow: 0 0 6px rgba(101, 92, 255, 0.4);
}

    </style>

<script>
    let currentStep = 1;

    function showStep(step) {
    document.querySelectorAll('.form-step').forEach((el, i) => {
        el.classList.toggle('d-none', i !== step - 1);
    });
    }

    function nextStep(step) {
    currentStep = step + 1;
    showStep(currentStep);
    }

    function prevStep(step) {
    currentStep = step - 1;
    showStep(currentStep);
    }

    function selectStyle(step, value) {
    const slider = document.getElementById(`slider${step}`);
    if (slider) slider.value = value;

    nextStep(step);
    }

    document.addEventListener("DOMContentLoaded", () => {
    showStep(currentStep);
    });
</script>

<script>

    document.querySelectorAll('.mission-button').forEach(btn => {
      btn.addEventListener('click', function () {
        this.classList.toggle('selected');
      });
    });
    
    document.getElementById('confirmMission').addEventListener('click', function () {
      const selected = document.querySelectorAll('.mission-button.selected');
      const values = Array.from(selected).map(el => el.getAttribute('data-code'));
      const labels = Array.from(selected).map(el => el.textContent.trim());
    
      document.getElementById('mission_ENC_hidden').value = values.join(',');
      document.getElementById('selected_missions_text').innerText =
        labels.length > 0 ? `ì„ íƒí•œ ë¯¸ì…˜: ${labels.join(', ')}` : 'ì„ íƒëœ ë¯¸ì…˜ ì—†ìŒ';
    
      $('#missionModal').modal('hide');
    });

    const picker = new Litepicker({
        element: document.getElementById('date_range'),
        singleMode: false,
        format: 'YYYY-MM-DD',
        onSelect: (start, end) => {
            document.getElementById('start_date').value = start.format('YYYY-MM-DD');
            document.getElementById('end_date').value = end.format('YYYY-MM-DD');
        }
    });

    document.getElementById('missionToggle').addEventListener('change', function () {
        const isChecked = this.checked;
        const missionLabel = document.getElementById('missionToggleLabel');
        const missionFields = document.getElementById('normal_mission_fields');
        const missionTypeHidden = document.getElementById('mission_type_hidden');

        if (isChecked) {
            missionLabel.textContent = 'íŠ¹ë³„ ë¯¸ì…˜';
            missionFields.style.display = 'none';
            missionTypeHidden.value = 'special';
        } else {
            missionLabel.textContent = 'ì¼ë°˜ ì—¬í–‰';
            missionFields.style.display = 'block';
            missionTypeHidden.value = 'normal';
        }
    });

    // ì´ˆê¸°í™” ì‹œ ë¯¸ì…˜ í•„ë“œ ë³´ì´ë„ë¡
    document.getElementById('normal_mission_fields').style.display = 'block';
</script>

{% endblock %}